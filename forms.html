<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cantilan Business Express - Online Permit Filing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Merriweather:wght@400;700&display=swap');
        
        :root {
            --cantilan-blue: #0038A8;
            --cantilan-red: #CE1126;
            --cantilan-gold: #FCD116;
            --official-blue: #1e3a8a;
            --official-red: #dc2626;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        
        .serif {
            font-family: 'Merriweather', serif;
        }
        
        /* Official Header Style */
        .official-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #0038A8 100%);
            border-bottom: 4px solid var(--cantilan-gold);
        }
        
        .seal-container {
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
            transition: transform 0.3s ease;
        }
        
        .seal-container:hover {
            transform: scale(1.05);
        }
        
        /* Gold Accent Button */
        .btn-gold {
            background: linear-gradient(135deg, #FCD116 0%, #FFD700 100%);
            color: #1e3a8a;
            border: 2px solid #FCD116;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 4px 6px -1px rgba(252, 209, 22, 0.4);
        }
        
        .btn-gold:hover {
            background: linear-gradient(135deg, #FFD700 0%, #FCD116 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(252, 209, 22, 0.4);
        }
        
        /* Service Cards Matching Reference Site */
        .service-card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--cantilan-blue), var(--cantilan-red));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: #0038A8;
        }
        
        .service-card:hover::before {
            transform: scaleX(1);
        }
        
        .service-icon {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            color: #0038A8;
        }
        
        /* Form Steps */
        .form-step {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }
        
        .form-step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Progress Bar */
        .progress-step {
            position: relative;
        }
        
        .progress-step::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #e5e7eb;
            z-index: 0;
            transform: translateY(-50%);
        }
        
        .progress-step:last-child::after {
            display: none;
        }
        
        .progress-step.active .step-number {
            background: #0038A8;
            color: white;
            border-color: #0038A8;
        }
        
        .progress-step.completed .step-number {
            background: #059669;
            color: white;
            border-color: #059669;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #d1d5db;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            position: relative;
            z-index: 1;
            transition: all 0.3s;
        }
        
        /* Document Upload */
        .document-preview {
            border: 2px dashed #cbd5e1;
            transition: all 0.2s;
            background: #f8fafc;
        }
        
        .document-preview:hover {
            border-color: #0038A8;
            background-color: #eff6ff;
        }
        
        .document-preview.has-file {
            border-color: #059669;
            background-color: #f0fdf4;
            border-style: solid;
        }
        
        /* Blue Theme Inputs */
        .input-field:focus {
            border-color: #0038A8;
            box-shadow: 0 0 0 3px rgba(0, 56, 168, 0.1);
        }
        
        /* Modal Styles */
        .modal-backdrop {
            background-color: rgba(30, 58, 138, 0.6);
            backdrop-filter: blur(4px);
        }
        
        .login-gradient {
            background: linear-gradient(135deg, #0038A8 0%, #1e3a8a 100%);
        }
        
        /* Status Badges */
        .badge-pending {
            background: #FEF3C7;
            color: #92400E;
            border: 1px solid #FCD34D;
        }
        
        .badge-approved {
            background: #D1FAE5;
            color: #065F46;
            border: 1px solid #6EE7B7;
        }
        
        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .glass-panel { box-shadow: none; border: 1px solid #ccc; }
        }
        
        /* Loading Spinner */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #0038A8;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        /* Accordion Style from Reference */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .accordion-content.active {
            max-height: 1000px;
        }
        
        /* Gold Top Bar */
        .top-bar {
            background: var(--cantilan-gold);
            color: #1e3a8a;
            font-size: 0.75rem;
            font-weight: 600;
        }
    </style>
</head>
<body class="min-h-screen text-gray-800 bg-slate-50">

    <!-- Gold Top Bar -->
    <div class="top-bar py-1 text-center no-print">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <span><i class="fas fa-phone-alt mr-2"></i>Trunk Line: (086) XXX-XXXX</span>
            <span class="hidden md:inline"><i class="fas fa-envelope mr-2"></i>lgucantilan@example.gov.ph</span>
            <span>Open Monday - Friday, 8:00 AM - 5:00 PM</span>
        </div>
    </div>

    <!-- Official Header with Seal -->
    <nav class="official-header text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-4 cursor-pointer" onclick="showDashboard()">
                <!-- Cantilan Official Seal -->
                <div class="seal-container w-16 h-16 md:w-20 md:h-20 bg-white rounded-full p-1 flex-shrink-0">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Seal_of_Cantilan.png/600px-Seal_of_Cantilan.png" 
                         alt="Municipality of Cantilan Official Seal" 
                         class="w-full h-full object-contain rounded-full"
                         onerror="this.src='https://via.placeholder.com/100?text=Seal'">
                </div>
                <div class="border-l-2 border-yellow-400 pl-4">
                    <p class="text-xs md:text-sm text-blue-100 font-medium tracking-wider">Republic of the Philippines</p>
                    <h1 class="text-lg md:text-2xl font-bold leading-tight serif tracking-wide">Municipality of Cantilan</h1>
                    <p class="text-xs md:text-sm text-blue-100">Province of Surigao del Sur</p>
                </div>
            </div>
            
            <!-- Auth Section -->
            <div id="authSection" class="flex items-center space-x-3">
                <!-- Logged Out State -->
                <div id="loggedOutNav" class="flex items-center space-x-3">
                    <button onclick="showLoginModal()" class="hidden md:block text-white hover:text-yellow-300 transition text-sm font-medium px-3 py-2">
                        Track Application
                    </button>
                    <button onclick="showLoginModal()" class="btn-gold px-6 py-2.5 rounded-lg flex items-center text-sm shadow-lg">
                        <i class="fas fa-user-lock mr-2"></i>Login
                    </button>
                </div>

                <!-- Logged In State -->
                <div id="loggedInNav" class="hidden items-center space-x-3">
                    <div class="text-right hidden md:block">
                        <p class="text-sm font-bold text-white" id="userNameDisplay">Juan Dela Cruz</p>
                        <p class="text-xs text-blue-200" id="userEmailDisplay">juan@email.com</p>
                    </div>
                    <div class="relative group">
                        <button class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-900 font-bold border-2 border-yellow-400 hover:bg-yellow-50 transition">
                            <i class="fas fa-user"></i>
                        </button>
                        <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-2 hidden group-hover:block text-gray-800 border border-gray-200 z-50">
                            <a href="#" class="block px-4 py-2 hover:bg-blue-50 text-sm text-blue-900 font-medium">
                                <i class="fas fa-user-circle mr-2 text-blue-600"></i>My Profile
                            </a>
                            <a href="#" class="block px-4 py-2 hover:bg-blue-50 text-sm text-blue-900">
                                <i class="fas fa-file-alt mr-2 text-blue-600"></i>My Applications
                            </a>
                            <div class="border-t border-gray-200 my-1"></div>
                            <a href="#" onclick="logout()" class="block px-4 py-2 hover:bg-red-50 text-sm text-red-600 font-medium">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Menu Button -->
            <button class="md:hidden text-2xl text-white hover:text-yellow-300" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="hidden bg-blue-900 text-white p-4 md:hidden border-t border-blue-800">
        <div id="mobileLoggedOut">
            <a href="#" class="block py-3 border-b border-blue-800 hover:text-yellow-300" onclick="showDashboard()">Home</a>
            <a href="#" class="block py-3 border-b border-blue-800 hover:text-yellow-300" onclick="showLoginModal()">Track Application</a>
            <button onclick="showLoginModal()" class="w-full mt-3 btn-gold py-3 rounded-lg text-blue-900 font-bold">Login</button>
        </div>
        <div id="mobileLoggedIn" class="hidden">
            <div class="px-2 py-3 border-b border-blue-800 mb-2 flex items-center space-x-3">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-900">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <p class="font-bold" id="mobileUserName">User</p>
                    <p class="text-xs text-blue-200" id="mobileUserEmail">email</p>
                </div>
            </div>
            <a href="#" class="block py-3 border-b border-blue-800 hover:text-yellow-300">My Applications</a>
            <a href="#" class="block py-3 border-b border-blue-800 hover:text-yellow-300">Profile</a>
            <a href="#" class="block py-3 text-red-300 hover:text-red-200" onclick="logout()">Logout</a>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all scale-95 opacity-0" id="loginModalContent">
            <div class="login-gradient p-6 text-white text-center relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-16 -mt-16"></div>
                <div class="w-20 h-20 bg-white rounded-full mx-auto mb-3 p-2 flex items-center justify-center">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Seal_of_Cantilan.png/600px-Seal_of_Cantilan.png" 
                         class="w-full h-full object-contain" alt="Seal"
                         onerror="this.src='https://via.placeholder.com/80?text=Seal'">
                </div>
                <h2 class="text-2xl font-bold serif">Cantilan Business Express</h2>
                <p class="text-blue-100 text-sm mt-1">Secure Login Portal</p>
            </div>
            
            <div class="p-6 space-y-4">
                <div id="loginError" class="hidden bg-red-50 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded text-sm flex items-center">
                    <i class="fas fa-exclamation-circle mr-2"></i>
                    <span>Invalid credentials. Please try again.</span>
                </div>

                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-blue-600">
                                    <i class="fas fa-envelope"></i>
                                </span>
                                <input type="email" id="loginEmail" required 
                                    class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-800 focus:ring-2 focus:ring-blue-100 transition"
                                    placeholder="you@example.com" value="demo@cantilan.gov.ph">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-blue-600">
                                    <i class="fas fa-lock"></i>
                                </span>
                                <input type="password" id="loginPassword" required 
                                    class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-800 focus:ring-2 focus:ring-blue-100 transition"
                                    placeholder="••••••••" value="password123">
                                <button type="button" onclick="togglePassword()" class="absolute right-3 top-3 text-gray-400 hover:text-blue-800 transition">
                                    <i class="fas fa-eye" id="toggleIcon"></i>
                                </button>
                            </div>
                        </div>

                        <div class="flex items-center justify-between text-sm">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" class="rounded border-gray-300 text-blue-800 focus:ring-blue-800">
                                <span class="ml-2 text-gray-600">Remember me</span>
                            </label>
                            <a href="#" class="text-blue-800 hover:underline font-medium">Forgot password?</a>
                        </div>

                        <button type="submit" id="loginBtn" 
                            class="w-full bg-blue-900 text-white py-3 rounded-lg font-bold hover:bg-blue-800 transition shadow-lg flex items-center justify-center space-x-2 border-b-4 border-blue-950 active:border-b-0 active:translate-y-1">
                            <span>Login</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </form>

                <div class="relative py-2">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-200"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">New applicant?</span>
                    </div>
                </div>

                <button onclick="showRegisterModal()" 
                    class="w-full border-2 border-blue-900 text-blue-900 py-3 rounded-lg font-bold hover:bg-blue-50 transition">
                    Create Account
                </button>

                <button onclick="closeLoginModal()" 
                    class="w-full text-gray-500 text-sm hover:text-gray-700 py-2 font-medium">
                    Cancel and Return to Home
                </button>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="registerModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop overflow-y-auto">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg my-8 transform transition-all scale-95 opacity-0" id="registerModalContent">
            <div class="bg-gradient-to-r from-blue-900 to-blue-800 p-6 text-white text-center">
                <h2 class="text-2xl font-bold serif">Create Account</h2>
                <p class="text-blue-200 text-sm mt-1">Join Cantilan Business Express</p>
            </div>
            
            <div class="p-6 space-y-4">
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                            <input type="text" id="regFirstName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-800 focus:ring-2 focus:ring-blue-100">
                        </div>
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                            <input type="text" id="regLastName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-800 focus:ring-2 focus:ring-blue-100">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email Address *</label>
                        <input type="email" id="regEmail" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-800 focus:ring-2 focus:ring-blue-100">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mobile Number *</label>
                        <input type="tel" id="regMobile" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-800 focus:ring-2 focus:ring-blue-100" placeholder="09XX XXX XXXX">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Address in Cantilan *</label>
                        <input type="text" id="regAddress" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-800 focus:ring-2 focus:ring-blue-100" placeholder="Barangay, Cantilan, Surigao del Sur">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
                            <input type="password" id="regPassword" required minlength="8" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-800 focus:ring-2 focus:ring-blue-100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password *</label>
                            <input type="password" id="regConfirmPassword" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-800 focus:ring-2 focus:ring-blue-100">
                        </div>
                    </div>

                    <div class="flex items-start space-x-2 pt-2">
                        <input type="checkbox" id="agreeTerms" required class="mt-1 rounded border-gray-300 text-blue-800 focus:ring-blue-800">
                        <label for="agreeTerms" class="text-xs text-gray-600">
                            I agree to the <a href="#" class="text-blue-800 hover:underline font-medium">Terms of Service</a> and 
                            <a href="#" class="text-blue-800 hover:underline font-medium">Privacy Policy</a>. I consent to the processing of my personal data in accordance with RA 10173 (Data Privacy Act of 2012).
                        </label>
                    </div>

                    <button type="submit" id="registerBtn" class="w-full bg-blue-900 text-white py-3 rounded-lg font-bold hover:bg-blue-800 transition shadow-lg border-b-4 border-blue-950 active:border-b-0 active:translate-y-1">
                        Create Account
                    </button>
                </form>

                <div class="text-center text-sm text-gray-600">
                    Already have an account? 
                    <a href="#" onclick="switchToLogin()" class="text-blue-800 font-bold hover:underline">Login here</a>
                </div>

                <button onclick="closeRegisterModal()" class="w-full text-gray-500 text-sm hover:text-gray-700 py-2 font-medium">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        
        <!-- Dashboard -->
        <div id="dashboard" class="space-y-8">
            <!-- Hero Section -->
            <div class="text-center space-y-4 mb-12">
                <div class="inline-block px-4 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-bold mb-2 border border-blue-200">
                    <i class="fas fa-shield-alt mr-2"></i>Official Government Portal
                </div>
                <h2 class="text-4xl md:text-5xl font-bold text-gray-900 serif tracking-tight">
                    Cantilan Business Express
                </h2>
                <p class="text-gray-600 max-w-2xl mx-auto text-lg">
                    Fast, secure, and transparent online filing for business permits, 
                    zoning certifications, and locational clearances.
                </p>
                <div class="flex justify-center gap-6 text-sm text-gray-500 mt-6 flex-wrap">
                    <span class="flex items-center font-medium"><i class="fas fa-check-circle text-blue-600 mr-2"></i>BPLO Accredited</span>
                    <span class="flex items-center font-medium"><i class="fas fa-check-circle text-blue-600 mr-2"></i>MPDC Verified</span>
                    <span class="flex items-center font-medium"><i class="fas fa-check-circle text-blue-600 mr-2"></i>24/7 Online Access</span>
                </div>
            </div>

            <!-- Auth Notice -->
            <div id="authNotice" class="hidden bg-amber-50 border-l-4 border-amber-500 rounded-r-xl p-4 mb-8 shadow-sm">
                <div class="flex items-start space-x-3">
                    <div class="w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-lock text-amber-600"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-amber-900 mb-1">Authentication Required</h3>
                        <p class="text-sm text-amber-800 mb-3">
                            To ensure the security of your application and comply with the Data Privacy Act, 
                            please login or register to proceed.
                        </p>
                        <div class="flex space-x-3">
                            <button onclick="showLoginModal()" class="px-4 py-2 bg-blue-900 text-white rounded-lg text-sm font-bold hover:bg-blue-800 transition">
                                Login to Continue
                            </button>
                            <button onclick="showRegisterModal()" class="px-4 py-2 border-2 border-blue-900 text-blue-900 rounded-lg text-sm font-bold hover:bg-blue-50 transition">
                                Register New Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Grid -->
            <div class="grid md:grid-cols-3 gap-6 mb-12">
                <!-- Business Permit -->
                <div class="service-card p-6 md:p-8 text-center group cursor-pointer" onclick="selectPermit('business')">
                    <div class="w-16 h-16 service-icon rounded-full flex items-center justify-center text-3xl mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-store"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2 group-hover:text-blue-900 transition">Business Permit</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        Mayor's Permit & Business License for new applications, renewals, and additional businesses.
                    </p>
                    <ul class="text-left text-sm text-gray-600 space-y-2 mb-6 bg-gray-50 p-3 rounded-lg">
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>Unified Application Form</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>Sanitary & Fire Permits</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>Zoning Clearance</li>
                    </ul>
                    <button class="w-full py-2.5 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition shadow-md">
                        Apply Now
                    </button>
                </div>

                <!-- Zoning Certification -->
                <div class="service-card p-6 md:p-8 text-center group cursor-pointer" onclick="selectPermit('zoning')">
                    <div class="w-16 h-16 service-icon rounded-full flex items-center justify-center text-3xl mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2 group-hover:text-blue-900 transition">Zoning Certification</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        Verify land use compliance and zoning classification from the Municipal Planning & Development Office.
                    </p>
                    <ul class="text-left text-sm text-gray-600 space-y-2 mb-6 bg-gray-50 p-3 rounded-lg">
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>Vicinity Map Review</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>Land Use Verification</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>Property Rights Check</li>
                    </ul>
                    <button class="w-full py-2.5 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition shadow-md">
                        Apply Now
                    </button>
                </div>

                <!-- Locational Clearance -->
                <div class="service-card p-6 md:p-8 text-center group cursor-pointer" onclick="selectPermit('locational')">
                    <div class="w-16 h-16 service-icon rounded-full flex items-center justify-center text-3xl mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2 group-hover:text-blue-900 transition">Locational Clearance</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        HLURB-compliant clearance for new developments, renovations, and construction projects.
                    </p>
                    <ul class="text-left text-sm text-gray-600 space-y-2 mb-6 bg-gray-50 p-3 rounded-lg">
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>Project Evaluation</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>Environmental Check</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>Development Approval</li>
                    </ul>
                    <button class="w-full py-2.5 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition shadow-md">
                        Apply Now
                    </button>
                </div>
            </div>

            <!-- Process Steps -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-12 border border-gray-200">
                <h3 class="text-2xl font-bold text-center mb-8 text-blue-900 serif">General Filing Process</h3>
                <div class="grid md:grid-cols-4 gap-6">
                    <div class="text-center space-y-3 relative">
                        <div class="w-12 h-12 bg-blue-900 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto border-4 border-blue-100">1</div>
                        <h4 class="font-bold text-gray-900">Barangay Level</h4>
                        <p class="text-sm text-gray-600">Secure Barangay Clearance from your local Barangay Captain</p>
                    </div>
                    <div class="text-center space-y-3 relative">
                        <div class="w-12 h-12 bg-blue-900 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto border-4 border-blue-100">2</div>
                        <h4 class="font-bold text-gray-900">Zoning & Health</h4>
                        <p class="text-sm text-gray-600">Obtain Locational Clearance (MPDC) and Health/Sanitary Permit</p>
                    </div>
                    <div class="text-center space-y-3 relative">
                        <div class="w-12 h-12 bg-blue-900 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto border-4 border-blue-100">3</div>
                        <h4 class="font-bold text-gray-900">Fire & Safety</h4>
                        <p class="text-sm text-gray-600">Secure Fire Safety Inspection Certificate from BFP</p>
                    </div>
                    <div class="text-center space-y-3 relative">
                        <div class="w-12 h-12 bg-blue-900 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto border-4 border-blue-100">4</div>
                        <h4 class="font-bold text-gray-900">Mayor's Office</h4>
                        <p class="text-sm text-gray-600">Submit all to BPLO for the official Mayor's Permit</p>
                    </div>
                </div>
            </div>

            <!-- Recent Applications -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-blue-900 flex items-center">
                        <i class="fas fa-history text-blue-600 mr-2"></i>
                        Recent Applications
                    </h3>
                    <button onclick="showLoginModal()" id="viewAllBtn" class="text-sm text-blue-800 hover:underline font-bold">Login to view all</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50 text-gray-700 border-b border-gray-200">
                            <tr>
                                <th class="px-4 py-3 text-left font-semibold">Reference No.</th>
                                <th class="px-4 py-3 text-left font-semibold">Permit Type</th>
                                <th class="px-4 py-3 text-left font-semibold">Date Filed</th>
                                <th class="px-4 py-3 text-left font-semibold">Status</th>
                                <th class="px-4 py-3 text-left font-semibold">Action</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100" id="recentApplications">
                            <tr>
                                <td colspan="5" class="px-4 py-8 text-center text-gray-400">
                                    <i class="fas fa-lock text-3xl mb-2 text-gray-300"></i>
                                    <p>Please login to view your applications</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Application Form -->
        <div id="applicationForm" class="hidden space-y-6">
            <div class="flex items-center justify-between mb-6 no-print">
                <button onclick="showDashboard()" class="text-blue-900 hover:text-blue-700 flex items-center font-medium">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
                </button>
                <div class="text-sm text-gray-600 bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm">
                    App ID: <span class="font-mono font-bold text-blue-900" id="appIdDisplay">-</span>
                </div>
            </div>

            <!-- Progress Steps -->
            <div class="bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-gray-200 no-print">
                <div class="flex justify-between relative">
                    <div class="progress-step flex-1 text-center ${currentStep >= 1 ? 'active' : ''} ${currentStep > 1 ? 'completed' : ''}" id="progStep1">
                        <div class="step-number mx-auto mb-2">1</div>
                        <p class="text-xs font-medium text-gray-600">Classification</p>
                    </div>
                    <div class="progress-step flex-1 text-center ${currentStep >= 2 ? 'active' : ''} ${currentStep > 2 ? 'completed' : ''}" id="progStep2">
                        <div class="step-number mx-auto mb-2">2</div>
                        <p class="text-xs font-medium text-gray-600">Information</p>
                    </div>
                    <div class="progress-step flex-1 text-center ${currentStep >= 3 ? 'active' : ''} ${currentStep > 3 ? 'completed' : ''}" id="progStep3">
                        <div class="step-number mx-auto mb-2">3</div>
                        <p class="text-xs font-medium text-gray-600">Documents</p>
                    </div>
                    <div class="progress-step flex-1 text-center ${currentStep >= 4 ? 'active' : ''}" id="progStep4">
                        <div class="step-number mx-auto mb-2">4</div>
                        <p class="text-xs font-medium text-gray-600">Review</p>
                    </div>
                </div>
            </div>

            <div id="formContainer" class="bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-gray-200 min-h-[400px]">
                <!-- Dynamic content -->
            </div>

            <div class="flex justify-between no-print">
                <button id="prevBtn" onclick="prevStep()" class="hidden px-6 py-3 border-2 border-gray-300 rounded-lg font-bold text-gray-700 hover:bg-gray-50 hover:border-blue-900 hover:text-blue-900 transition">
                    <i class="fas fa-arrow-left mr-2"></i>Previous
                </button>
                <button id="nextBtn" onclick="nextStep()" class="ml-auto px-8 py-3 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition flex items-center shadow-lg border-b-4 border-blue-950 active:border-b-0 active:translate-y-1">
                    <span>Next Step</span>
                    <i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 modal-backdrop">
            <div class="bg-white rounded-2xl max-w-md w-full p-8 text-center transform transition-all scale-95 opacity-0 shadow-2xl border-4 border-blue-100" id="successModalContent">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-4xl mx-auto mb-4 border-4 border-green-200">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 class="text-2xl font-bold mb-2 text-blue-900 serif">Application Submitted!</h3>
                <p class="text-gray-600 mb-6">
                    Your application has been successfully filed with the Municipality of Cantilan.
                </p>
                <div class="bg-blue-50 p-4 rounded-lg mb-6 border-2 border-dashed border-blue-300">
                    <p class="text-xs text-blue-600 font-bold uppercase tracking-wider mb-1">Reference Number</p>
                    <p class="text-2xl font-mono font-bold text-blue-900" id="successRefNo">-</p>
                </div>
                <div class="space-y-3">
                    <button onclick="printApplication()" class="w-full py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-bold text-gray-700 transition">
                        <i class="fas fa-print mr-2"></i>Print Application
                    </button>
                    <button onclick="showDashboard()" class="w-full py-3 bg-blue-900 text-white rounded-lg hover:bg-blue-800 font-bold transition shadow-md">
                        <i class="fas fa-home mr-2"></i>Return to Dashboard
                    </button>
                </div>
            </div>
        </div>

        <!-- Contact Section -->
        <div class="mt-12 bg-blue-900 text-white rounded-2xl p-8 shadow-xl">
            <div class="grid md:grid-cols-3 gap-8 text-center">
                <div>
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-map-marker-alt text-yellow-400 text-xl"></i>
                    </div>
                    <h4 class="font-bold mb-1">Municipal Hall</h4>
                    <p class="text-sm text-blue-200">Cantilan, Surigao del Sur</p>
                    <p class="text-xs text-blue-300 mt-1">Monday - Friday, 8:00 AM - 5:00 PM</p>
                </div>
                <div>
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-phone-alt text-yellow-400 text-xl"></i>
                    </div>
                    <h4 class="font-bold mb-1">Trunk Line</h4>
                    <p class="text-sm text-blue-200">(086) XXX-XXXX</p>
                    <p class="text-xs text-blue-300 mt-1">Call during office hours</p>
                </div>
                <div>
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-envelope text-yellow-400 text-xl"></i>
                    </div>
                    <h4 class="font-bold mb-1">Email Support</h4>
                    <p class="text-sm text-blue-200">lgucantilan@example.gov.ph</p>
                    <p class="text-xs text-blue-300 mt-1">Response within 2-3 business days</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-8 text-center text-sm text-gray-500 pb-8">
            <p>&copy; 2024 Municipality of Cantilan, Surigao del Sur. All rights reserved.</p>
            <p class="mt-1">Official Government Portal | Republic of the Philippines</p>
        </footer>
    </div>

    <script>
        // State Management
        let currentPermit = null;
        let currentStep = 1;
        let formData = {};
        let totalSteps = 4;
        let isLoggedIn = false;
        let currentUser = null;
        let pendingPermitSelection = null;
        
        const permitTypes = {
            business: {
                title: "Unified Business Permit",
                color: "blue",
                steps: ["Classification", "Information", "Documents", "Review"]
            },
            zoning: {
                title: "Zoning Certification",
                color: "green",
                steps: ["Type", "Details", "Documents", "Review"]
            },
            locational: {
                title: "Locational Clearance",
                color: "purple",
                steps: ["Nature", "Project Info", "Requirements", "Review"]
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const savedSession = localStorage.getItem('cantilan_user_session');
            if (savedSession) {
                const session = JSON.parse(savedSession);
                if (session.expiry > Date.now()) {
                    loginUser(session.user, false);
                } else {
                    localStorage.removeItem('cantilan_user_session');
                }
            }
            generateRandomAppId();
            updateAuthUI();
        });

        function generateRandomAppId() {
            const id = 'CNT-' + Date.now().toString(36).toUpperCase().slice(-6);
            document.getElementById('appIdDisplay').textContent = id;
            formData.applicationId = id;
            formData.dateFiled = new Date().toISOString().split('T')[0];
        }

        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            const content = document.getElementById('loginModalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
            document.body.style.overflow = 'hidden';
        }

        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            const content = document.getElementById('loginModalContent');
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
            document.body.style.overflow = 'auto';
            document.getElementById('loginError').classList.add('hidden');
        }

        function showRegisterModal() {
            closeLoginModal();
            setTimeout(() => {
                const modal = document.getElementById('registerModal');
                const content = document.getElementById('registerModalContent');
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.classList.remove('scale-95', 'opacity-0');
                    content.classList.add('scale-100', 'opacity-100');
                }, 10);
            }, 300);
        }

        function closeRegisterModal() {
            const modal = document.getElementById('registerModal');
            const content = document.getElementById('registerModalContent');
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function switchToLogin() {
            closeRegisterModal();
            setTimeout(() => showLoginModal(), 300);
        }

        function togglePassword() {
            const input = document.getElementById('loginPassword');
            const icon = document.getElementById('toggleIcon');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            
            btn.innerHTML = '<div class="loading-spinner border-white border-t-transparent w-5 h-5"></div>';
            btn.disabled = true;
            
            setTimeout(() => {
                if (email && password.length >= 6) {
                    const user = {
                        email: email,
                        firstName: email.split('@')[0],
                        lastName: 'User',
                        fullName: email.split('@')[0].replace('.', ' ')
                    };
                    loginUser(user, true);
                    closeLoginModal();
                    
                    if (pendingPermitSelection) {
                        setTimeout(() => {
                            proceedToPermit(pendingPermitSelection);
                            pendingPermitSelection = null;
                        }, 500);
                    }
                } else {
                    document.getElementById('loginError').classList.remove('hidden');
                    const modal = document.getElementById('loginModalContent');
                    modal.classList.add('shake');
                    setTimeout(() => modal.classList.remove('shake'), 500);
                }
                
                btn.innerHTML = '<span>Login</span><i class="fas fa-arrow-right"></i>';
                btn.disabled = false;
            }, 1500);
        }

        function handleRegister(e) {
            e.preventDefault();
            const btn = document.getElementById('registerBtn');
            const password = document.getElementById('regPassword').value;
            const confirm = document.getElementById('regConfirmPassword').value;
            
            if (password !== confirm) {
                alert('Passwords do not match!');
                return;
            }
            
            btn.innerHTML = '<div class="loading-spinner border-white border-t-transparent w-5 h-5"></div>';
            
            setTimeout(() => {
                const user = {
                    email: document.getElementById('regEmail').value,
                    firstName: document.getElementById('regFirstName').value,
                    lastName: document.getElementById('regLastName').value,
                    fullName: document.getElementById('regFirstName').value + ' ' + document.getElementById('regLastName').value
                };
                
                loginUser(user, true);
                closeRegisterModal();
                
                if (pendingPermitSelection) {
                    setTimeout(() => {
                        proceedToPermit(pendingPermitSelection);
                        pendingPermitSelection = null;
                    }, 500);
                }
                
                btn.innerHTML = 'Create Account';
            }, 2000);
        }

        function loginUser(user, remember) {
            isLoggedIn = true;
            currentUser = user;
            
            if (remember) {
                const session = {
                    user: user,
                    expiry: Date.now() + (24 * 60 * 60 * 1000)
                };
                localStorage.setItem('cantilan_user_session', JSON.stringify(session));
            }
            
            updateAuthUI();
            loadRecentApplications();
        }

        function logout() {
            isLoggedIn = false;
            currentUser = null;
            localStorage.removeItem('cantilan_user_session');
            updateAuthUI();
            showDashboard();
            
            document.getElementById('recentApplications').innerHTML = `
                <tr>
                    <td colspan="5" class="px-4 py-8 text-center text-gray-400">
                        <i class="fas fa-lock text-3xl mb-2 text-gray-300"></i>
                        <p>Please login to view your applications</p>
                    </td>
                </tr>
            `;
        }

        function updateAuthUI() {
            const loggedOutNav = document.getElementById('loggedOutNav');
            const loggedInNav = document.getElementById('loggedInNav');
            const mobileLoggedOut = document.getElementById('mobileLoggedOut');
            const mobileLoggedIn = document.getElementById('mobileLoggedIn');
            const viewAllBtn = document.getElementById('viewAllBtn');
            const authNotice = document.getElementById('authNotice');
            
            if (isLoggedIn) {
                loggedOutNav.classList.add('hidden');
                loggedInNav.classList.remove('hidden');
                loggedInNav.classList.add('flex');
                mobileLoggedOut.classList.add('hidden');
                mobileLoggedIn.classList.remove('hidden');
                viewAllBtn.textContent = 'View All';
                viewAllBtn.onclick = () => {};
                authNotice.classList.add('hidden');
                
                document.getElementById('userNameDisplay').textContent = currentUser.fullName || currentUser.firstName;
                document.getElementById('userEmailDisplay').textContent = currentUser.email;
                document.getElementById('mobileUserName').textContent = currentUser.fullName || currentUser.firstName;
                document.getElementById('mobileUserEmail').textContent = currentUser.email;
            } else {
                loggedOutNav.classList.remove('hidden');
                loggedInNav.classList.add('hidden');
                loggedInNav.classList.remove('flex');
                mobileLoggedOut.classList.remove('hidden');
                mobileLoggedIn.classList.add('hidden');
                viewAllBtn.textContent = 'Login to view all';
                viewAllBtn.onclick = showLoginModal;
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        function selectPermit(type) {
            if (!isLoggedIn) {
                pendingPermitSelection = type;
                showAuthNotice();
                showLoginModal();
                return;
            }
            proceedToPermit(type);
        }

        function showAuthNotice() {
            const notice = document.getElementById('authNotice');
            notice.classList.remove('hidden');
            notice.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function proceedToPermit(type) {
            currentPermit = type;
            currentStep = 1;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('applicationForm').classList.remove('hidden');
            document.getElementById('authNotice').classList.add('hidden');
            
            renderProgressSteps();
            renderCurrentStep();
            window.scrollTo(0, 0);
        }

        function renderProgressSteps() {
            const steps = [1, 2, 3, 4];
            steps.forEach(step => {
                const el = document.getElementById(`progStep${step}`);
                el.classList.remove('active', 'completed');
                if (currentStep === step) {
                    el.classList.add('active');
                } else if (currentStep > step) {
                    el.classList.add('completed');
                }
            });
        }

        function showDashboard() {
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('applicationForm').classList.add('hidden');
            document.getElementById('authNotice').classList.add('hidden');
            currentStep = 1;
            formData = {};
            generateRandomAppId();
        }

        function updateProgress() {
            renderProgressSteps();
            
            document.getElementById('prevBtn').classList.toggle('hidden', currentStep === 1);
            const nextBtn = document.getElementById('nextBtn');
            if (currentStep === totalSteps) {
                nextBtn.innerHTML = '<span>Submit Application</span><i class="fas fa-paper-plane ml-2"></i>';
                nextBtn.classList.remove('bg-blue-900', 'hover:bg-blue-800');
                nextBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                nextBtn.innerHTML = '<span>Next Step</span><i class="fas fa-chevron-right ml-2"></i>';
                nextBtn.classList.add('bg-blue-900', 'hover:bg-blue-800');
                nextBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            }
        }

        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateProgress();
                    renderCurrentStep();
                    window.scrollTo(0, 0);
                } else {
                    submitApplication();
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateProgress();
                renderCurrentStep();
                window.scrollTo(0, 0);
            }
        }

        function validateCurrentStep() {
            const inputs = document.querySelectorAll('.form-step.active input[required], .form-step.active select[required]');
            let valid = true;
            
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    input.classList.add('border-red-500');
                    valid = false;
                } else {
                    input.classList.remove('border-red-500');
                }
            });
            
            if (!valid) {
                alert('Please fill in all required fields marked with *');
            }
            
            return valid;
        }

        function renderCurrentStep() {
            const container = document.getElementById('formContainer');
            container.innerHTML = '';
            
            switch(currentPermit) {
                case 'business':
                    renderBusinessStep(container);
                    break;
                case 'zoning':
                    renderZoningStep(container);
                    break;
                case 'locational':
                    renderLocationalStep(container);
                    break;
            }
        }

        function renderBusinessStep(container) {
            // Simplified for space - same logic as previous but styled with new theme
            if (currentStep === 1) {
                container.innerHTML = `
                    <div class="form-step active">
                        <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">Application Classification</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-3">Application Type *</label>
                                <div class="grid md:grid-cols-3 gap-4">
                                    ${['New', 'Renewal', 'Additional'].map(type => `
                                        <div class="border-2 ${formData.appType === type ? 'border-blue-900 bg-blue-50' : 'border-gray-200'} rounded-xl p-4 cursor-pointer hover:border-blue-900 transition text-center" 
                                             onclick="selectOption('appType', '${type}')">
                                            <input type="radio" name="appType" value="${type}" class="hidden" ${formData.appType === type ? 'checked' : ''}>
                                            <div class="font-bold text-lg text-gray-900">${type}</div>
                                            <div class="text-xs text-gray-500 mt-1">${type === 'New' ? 'First time' : type === 'Renewal' ? 'Annual' : 'Additional'}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Fiscal Year</label>
                                    <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100" value="${new Date().getFullYear()}" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Date</label>
                                    <input type="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100" value="${new Date().toISOString().split('T')[0]}" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStep === 2) {
                container.innerHTML = `
                    <div class="form-step active">
                        <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">Business Information</h3>
                        <div class="space-y-6">
                            <div class="bg-blue-50 p-5 rounded-xl border border-blue-100">
                                <h4 class="font-bold text-blue-900 mb-4">Business Details</h4>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Business Name *</label>
                                        <input type="text" name="businessName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                               value="${formData.businessName || ''}" onchange="updateFormData(this)">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">DTI/SEC Reg. No. *</label>
                                        <input type="text" name="regNumber" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                               value="${formData.regNumber || ''}" onchange="updateFormData(this)">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Business Type</label>
                                        <select name="businessType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" onchange="updateFormData(this)">
                                            <option>Sole Proprietorship</option>
                                            <option>Partnership</option>
                                            <option>Corporation</option>
                                            <option>Cooperative</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
                                <h4 class="font-bold text-gray-900 mb-4">Owner Information</h4>
                                <div class="grid md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Surname *</label>
                                        <input type="text" name="ownerSurname" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                               value="${formData.ownerSurname || ''}" onchange="updateFormData(this)">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">First Name *</label>
                                        <input type="text" name="ownerFirstName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                               value="${formData.ownerFirstName || ''}" onchange="updateFormData(this)">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">TIN *</label>
                                        <input type="text" name="tin" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                               value="${formData.tin || ''}" onchange="updateFormData(this)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStep === 3) {
                container.innerHTML = `
                    <div class="form-step active">
                        <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">Documentary Requirements</h3>
                        <div class="space-y-4">
                            ${[
                                {name: 'dti_reg', label: 'DTI/SEC Registration', required: true},
                                {name: 'fire_permit', label: 'Fire Safety Inspection', required: true},
                                {name: 'sanitary', label: 'Health/Sanitary Permit', required: true},
                                {name: 'zoning', label: 'Zoning Clearance', required: true}
                            ].map(doc => `
                                <div class="document-preview p-4 rounded-xl bg-white cursor-pointer" 
                                     onclick="document.getElementById('file_${doc.name}').click()" id="preview_${doc.name}">
                                    <input type="file" id="file_${doc.name}" class="hidden" accept=".pdf,.jpg,.png" 
                                           onchange="handleFileUpload(this, '${doc.name}', '${doc.label}')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center text-blue-900">
                                                <i class="fas fa-file-alt text-xl"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-900">${doc.label} ${doc.required ? '<span class="text-red-500">*</span>' : ''}</h4>
                                                <p class="text-xs text-gray-500 status-text">Click to upload PDF or Image</p>
                                            </div>
                                        </div>
                                        <i class="fas fa-cloud-upload-alt text-gray-400"></i>
                                    </div>
                                    <div class="uploaded-file hidden mt-3 p-3 bg-green-50 rounded-lg border border-green-200">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-green-700 font-medium filename-display"><i class="fas fa-check-circle mr-2"></i>Uploaded</span>
                                            <button onclick="event.stopPropagation(); removeFile('${doc.name}')" class="text-red-500 hover:text-red-700">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                renderReviewStep(container);
            }
        }

        function renderZoningStep(container) {
            if (currentStep === 1) {
                container.innerHTML = `
                    <div class="form-step active">
                        <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">Zoning Application Type</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="border-2 ${formData.zoningType === 'Certification' ? 'border-blue-900 bg-blue-50' : 'border-gray-200'} rounded-xl p-6 cursor-pointer hover:border-blue-900 transition" 
                                 onclick="selectOption('zoningType', 'Certification')">
                                <div class="text-4xl mb-3 text-blue-900"><i class="fas fa-certificate"></i></div>
                                <h4 class="font-bold text-lg">Zoning Certification</h4>
                                <p class="text-sm text-gray-600 mt-2">Verify land use compliance</p>
                            </div>
                            <div class="border-2 ${formData.zoningType === 'Clearance' ? 'border-blue-900 bg-blue-50' : 'border-gray-200'} rounded-xl p-6 cursor-pointer hover:border-blue-900 transition" 
                                 onclick="selectOption('zoningType', 'Clearance')">
                                <div class="text-4xl mb-3 text-blue-900"><i class="fas fa-check-circle"></i></div>
                                <h4 class="font-bold text-lg">Zoning Clearance</h4>
                                <p class="text-sm text-gray-600 mt-2">For construction projects</p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStep === 2) {
                container.innerHTML = `
                    <div class="form-step active">
                        <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">Property Details</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Applicant Name *</label>
                                <input type="text" name="applicantName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                       value="${formData.applicantName || currentUser?.fullName || ''}" onchange="updateFormData(this)">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Property Location (Street, Barangay) *</label>
                                <input type="text" name="propertyLocation" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                       value="${formData.propertyLocation || ''}" onchange="updateFormData(this)">
                            </div>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Lot Area (hectares) *</label>
                                    <input type="number" step="0.001" name="lotArea" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                           value="${formData.lotArea || ''}" onchange="updateFormData(this)">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Right over Land *</label>
                                    <select name="landRight" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" onchange="updateFormData(this)">
                                        <option value="">Select...</option>
                                        <option value="Owner" ${formData.landRight === 'Owner' ? 'selected' : ''}>Owner</option>
                                        <option value="Lessee" ${formData.landRight === 'Lessee' ? 'selected' : ''}>Lessee</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStep === 3) {
                container.innerHTML = `
                    <div class="form-step active">
                        <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">Requirements Upload</h3>
                        <div class="space-y-4">
                            <div class="document-preview p-4 rounded-xl bg-white cursor-pointer" onclick="document.getElementById('file_vicinity').click();">
                                <input type="file" id="file_vicinity" class="hidden" onchange="handleFileUpload(this, 'vicinity', 'Vicinity Map')">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center text-green-700">
                                            <i class="fas fa-map text-xl"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-medium text-gray-900">Vicinity Map <span class="text-red-500">*</span></h4>
                                            <p class="text-xs text-gray-500">Drawn to scale</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-upload text-gray-400"></i>
                                </div>
                                <div class="uploaded-file hidden mt-3 p-3 bg-green-50 rounded-lg border border-green-200">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-green-700 font-medium"><i class="fas fa-check-circle mr-2"></i>Uploaded</span>
                                        <button onclick="event.stopPropagation(); removeFile('vicinity')" class="text-red-500"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                renderReviewStep(container);
            }
        }

        function renderLocationalStep(container) {
            if (currentStep === 1) {
                container.innerHTML = `
                    <div class="form-step active">
                        <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">Project Classification</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-3">Project Nature *</label>
                                <div class="grid md:grid-cols-2 gap-4">
                                    ${['New Development', 'Renovation', 'Expansion', 'Temporary'].map(type => `
                                        <div class="border-2 ${formData.projectNature === type ? 'border-blue-900 bg-blue-50' : 'border-gray-200'} rounded-xl p-4 cursor-pointer hover:border-blue-900 transition text-center" 
                                             onclick="selectOption('projectNature', '${type}')">
                                            <div class="font-bold text-gray-900">${type}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Project Name *</label>
                                <input type="text" name="projectName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                       value="${formData.projectName || ''}" onchange="updateFormData(this)">
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStep === 2) {
                container.innerHTML = `
                    <div class="form-step active">
                        <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">Project Details</h3>
                        <div class="space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Applicant Name *</label>
                                    <input type="text" value="${currentUser?.fullName || ''}" readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Project Cost (PHP) *</label>
                                    <input type="number" name="projectCost" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                           value="${formData.projectCost || ''}" onchange="updateFormData(this)">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Project Location *</label>
                                <input type="text" name="projectLocation" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-900" 
                                       value="${formData.projectLocation || ''}" onchange="updateFormData(this)">
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStep === 3) {
                container.innerHTML = `
                    <div class="form-step active">
                        <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">HLURB Requirements</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            ${[
                                {name: 'plan', label: 'Site Development Plan', icon: 'blueprint'},
                                {name: 'tct', label: 'TCT/Proof of Ownership', icon: 'file-alt'}
                            ].map(doc => `
                                <div class="document-preview p-4 rounded-xl bg-white cursor-pointer" onclick="document.getElementById('file_${doc.name}').click();">
                                    <input type="file" id="file_${doc.name}" class="hidden" onchange="handleFileUpload(this, '${doc.name}', '${doc.label}')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-700">
                                            <i class="fas fa-${doc.icon}"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-medium text-sm text-gray-900">${doc.label}</h4>
                                            <p class="text-xs text-gray-500 status-text">Click to upload</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                renderReviewStep(container);
            }
        }

        function renderReviewStep(container) {
            container.innerHTML = `
                <div class="form-step active">
                    <h3 class="text-2xl font-bold mb-6 text-blue-900 serif">Review & Submit</h3>
                    <div class="bg-amber-50 border-l-4 border-amber-500 rounded-r-lg p-4 mb-6">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-exclamation-triangle text-amber-600 mt-1"></i>
                            <div>
                                <p class="text-sm text-amber-800 font-bold">Declaration</p>
                                <p class="text-sm text-amber-700 mt-1">
                                    I declare under penalty of perjury that all information is true and correct.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-4 border border-blue-200 mb-6">
                        <h4 class="font-bold text-blue-900 mb-2">Logged in as:</h4>
                        <p class="text-gray-700">${currentUser?.fullName || currentUser?.firstName} (${currentUser?.email})</p>
                    </div>

                    <div class="border-t pt-6">
                        <label class="flex items-start space-x-3 cursor-pointer">
                            <input type="checkbox" required class="mt-1 w-5 h-5 text-blue-900 rounded border-gray-300 focus:ring-blue-900" id="declarationCheck">
                            <span class="text-sm text-gray-700 leading-relaxed">
                                I confirm that all information provided is accurate and I authorize the Municipality of Cantilan to verify these details. I understand that false information may result in denial of the permit and possible legal action.
                            </span>
                        </label>
                    </div>
                </div>
            `;
        }

        function selectOption(field, value) {
            formData[field] = value;
            renderCurrentStep();
        }

        function updateFormData(input) {
            formData[input.name] = input.value;
        }

        function handleFileUpload(input, fieldName, label) {
            if (input.files && input.files[0]) {
                if (!formData.uploadedFiles) formData.uploadedFiles = [];
                const existing = formData.uploadedFiles.findIndex(f => f.field === fieldName);
                if (existing >= 0) {
                    formData.uploadedFiles[existing] = {field: fieldName, label: label, name: input.files[0].name};
                } else {
                    formData.uploadedFiles.push({field: fieldName, label: label, name: input.files[0].name});
                }

                const preview = document.getElementById(`preview_${fieldName}`);
                if (preview) {
                    preview.classList.add('has-file');
                    const status = preview.querySelector('.status-text');
                    const fileDiv = preview.querySelector('.uploaded-file');
                    const nameSpan = preview.querySelector('.filename-display');
                    if (status) status.textContent = input.files[0].name;
                    if (fileDiv) fileDiv.classList.remove('hidden');
                    if (nameSpan) nameSpan.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${input.files[0].name}`;
                }
            }
        }

        function removeFile(fieldName) {
            if (formData.uploadedFiles) {
                formData.uploadedFiles = formData.uploadedFiles.filter(f => f.field !== fieldName);
            }
            const input = document.getElementById(`file_${fieldName}`);
            if (input) input.value = '';
            const preview = document.getElementById(`preview_${fieldName}`);
            if (preview) {
                preview.classList.remove('has-file');
                const status = preview.querySelector('.status-text');
                const fileDiv = preview.querySelector('.uploaded-file');
                if (status) status.textContent = 'Click to upload PDF or Image';
                if (fileDiv) fileDiv.classList.add('hidden');
            }
        }

        function submitApplication() {
            const declaration = document.getElementById('declarationCheck');
            if (!declaration || !declaration.checked) {
                alert('Please accept the declaration to proceed.');
                return;
            }

            const btn = document.getElementById('nextBtn');
            btn.innerHTML = '<div class="loading-spinner border-white border-t-transparent w-5 h-5 mr-2"></div>Processing';
            btn.disabled = true;

            setTimeout(() => {
                const applications = JSON.parse(localStorage.getItem('cantilan_applications') || '[]');
                applications.push({
                    ref: formData.applicationId,
                    type: permitTypes[currentPermit].title,
                    date: formData.dateFiled,
                    status: 'Pending Verification',
                    applicant: currentUser?.email
                });
                localStorage.setItem('cantilan_applications', JSON.stringify(applications));

                document.getElementById('successRefNo').textContent = formData.applicationId;
                const modal = document.getElementById('successModal');
                const content = document.getElementById('successModalContent');
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.classList.remove('scale-95', 'opacity-0');
                    content.classList.add('scale-100', 'opacity-100');
                }, 10);
                
                btn.innerHTML = '<span>Next Step</span><i class="fas fa-chevron-right ml-2"></i>';
                btn.disabled = false;
            }, 2000);
        }

        function loadRecentApplications() {
            if (!isLoggedIn) return;
            
            const allApps = JSON.parse(localStorage.getItem('cantilan_applications') || '[]');
            const userApps = allApps.filter(app => app.applicant === currentUser?.email).slice(-5).reverse();
            const tbody = document.getElementById('recentApplications');
            
            if (userApps.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-4 py-8 text-center text-gray-400">
                            <i class="fas fa-folder-open text-3xl mb-2"></i>
                            <p>No applications yet. Start by applying for a permit.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = userApps.map(app => `
                <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
                    <td class="px-4 py-3 font-mono text-blue-900 font-bold">${app.ref}</td>
                    <td class="px-4 py-3">${app.type}</td>
                    <td class="px-4 py-3">${app.date}</td>
                    <td class="px-4 py-3"><span class="badge-pending px-2 py-1 rounded-full text-xs font-bold">${app.status}</span></td>
                    <td class="px-4 py-3"><button class="text-blue-900 hover:underline text-sm font-bold">View</button></td>
                </tr>
            `).join('');
        }

        function printApplication() {
            window.print();
        }

        // Event listeners for modal closing
        document.getElementById('loginModal').addEventListener('click', function(e) {
            if (e.target === this) closeLoginModal();
        });
        
        document.getElementById('registerModal').addEventListener('click', function(e) {
            if (e.target === this) closeRegisterModal();
        });
        
        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
